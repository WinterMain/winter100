---
layout: question
title:  如何异步上传文件？
date:   2020-03-09T05:22:29.000Z
description: 我想用jQuery异步上传文件。 $(document).ready(function () {    $("#uploadbutton").c...
img: 
author: Itachi小哥
category: question
answer: 9
tags: JavaScript
topic: JavaScript
---
<div class="article-root">
  <div class="article">
    {% include articleTitle.html info=page %}
    {% raw %}
    <div class="article-content"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我想用jQuery异步上传文件。 </font></font></p>

<p></p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js prettyprint prettyprinted" style=""><code><span class="pln">$</span><span class="pun">(</span><span class="pln">document</span><span class="pun">).</span><span class="pln">ready</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><font></font><span class="pln">
    $</span><span class="pun">(</span><span class="str">"#uploadbutton"</span><span class="pun">).</span><span class="pln">click</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><font></font><span class="pln">
        </span><span class="kwd">var</span><span class="pln"> filename </span><span class="pun">=</span><span class="pln"> $</span><span class="pun">(</span><span class="str">"#file"</span><span class="pun">).</span><span class="pln">val</span><span class="pun">();</span><font></font><span class="pln">
</span><font></font><span class="pln">
        $</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">({</span><font></font><span class="pln">
            type</span><span class="pun">:</span><span class="pln"> </span><span class="str">"POST"</span><span class="pun">,</span><font></font><span class="pln">
            url</span><span class="pun">:</span><span class="pln"> </span><span class="str">"addFile.do"</span><span class="pun">,</span><font></font><span class="pln">
            enctype</span><span class="pun">:</span><span class="pln"> </span><span class="str">'multipart/form-data'</span><span class="pun">,</span><font></font><span class="pln">
            data</span><span class="pun">:</span><span class="pln"> </span><span class="pun">{</span><font></font><span class="pln">
                file</span><span class="pun">:</span><span class="pln"> filename</span><font></font><span class="pln">
            </span><span class="pun">},</span><font></font><span class="pln">
            success</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><font></font><span class="pln">
                alert</span><span class="pun">(</span><span class="str">"Data Uploaded: "</span><span class="pun">);</span><font></font><span class="pln">
            </span><span class="pun">}</span><font></font><span class="pln">
        </span><span class="pun">});</span><font></font><span class="pln">
    </span><span class="pun">});</span><font></font><span class="pln">
</span><span class="pun">});</span></code></pre>
<pre class="snippet-code-html lang-html prettyprint prettyprinted" style=""><code><span class="tag">&lt;script</span><span class="pln"> </span><span class="atn">src</span><span class="pun">=</span><span class="atv">"https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.0/jquery.min.js"</span><span class="tag">&gt;&lt;/script&gt;</span><font></font><span class="pln">
</span><span class="tag">&lt;span&gt;</span><span class="pln">File</span><span class="tag">&lt;/span&gt;</span><font></font><span class="pln">
</span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"file"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"file"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"file"</span><span class="pln"> </span><span class="atn">size</span><span class="pun">=</span><span class="atv">"10"</span><span class="tag">/&gt;</span><font></font><span class="pln">
</span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"uploadbutton"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"button"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"Upload"</span><span class="tag">/&gt;</span></code></pre>
<div class="snippet-result"><div class="snippet-ctas"><button type="button" class="s-btn s-btn__primary"><span class="icon-play-white _hover"></span><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 运行代码段</font></font></span></button><input class="copySnippet s-btn s-btn__filled" type="button" value="Copy snippet to answer" style="display: none;"><button type="button" class="s-btn hideResults" style="display: none;">Hide results</button><div class="popout-code"><a class="snippet-expand-link" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展开摘要</font></font></a></div></div><div class="snippet-result-code" style="display: none;"><iframe name="sif1" sandbox="allow-forms allow-modals allow-scripts" class="snippet-box-edit" frameborder="0"></iframe></div></div></div>
</div>
<p></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我只获取文件名，而不是上传文件。</font><font style="vertical-align: inherit;">我该怎么做才能解决此问题？</font></font></p></div>
    {% endraw %}
  </div>
  <p class="winter_mark">第164篇《如何异步上传文件？》来自Winter(https://github.com/aiyld/aiyld.github.io)的站点</p>
  <div class="discuss-wrapper">
    {% include discussTitle.html info=page %}
    {% raw %}
    <div class="discuss-list">
    <div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">YOC96576526</span>
            <span class="discuss-time">2020.06.12</span>
          </div>
          <div class="discuss-comment"><p>In Controller</p><pre><code class="language-cs">[HttpPost] 
        public ActionResult UploadFiles()
        {
            if (Request.Files.Count &gt; 0)
            {
                var files = Request.Files;

                //iterating through multiple file collection   
                foreach (string str in files)
                {
                    HttpPostedFileBase file = Request.Files[str] as HttpPostedFileBase;
                    //Checking file is available to save.  
                    if (file != null)
                    {
                        var InputFileName = Path.GetFileName(file.FileName);
                        var ServerSavePath = Path.Combine(Server.MapPath("~/Uploads/") + InputFileName);
                        //Save file to server folder  
                        file.SaveAs(ServerSavePath);
                       
                    }

                }
                return Json("File Uploaded Successfully!");
            }
            else
            {
                return Json("No files to upload");
            }
        }</code></pre><p>Source : <a href="https://qawithexperts.com/article/asp.net/file-uploading-using-jquery-ajax-in-mvc-single-or-multiple-f/98">jQuery Ajax File upload MVC</a></p><p><a href="https://qawithexperts.com/article/asp.net/uploading-files-in-aspnet-mvc-c-single-multiple-files/67">File Upload in MVC</a></p><p>In View</p><pre><code class="language-javascript">$('#Upload').click(function () {     



            var fileUpload = $("#files").get(0);

            var files = fileUpload.files;



            // Create  a FormData object

            var fileData = new FormData();



            // if there are multiple files , loop through each files

            for (var i = 0; i &lt; files.length; i++) {

                fileData.append(files[i].name, files[i]);

            }



            // Adding more keys/values here if need

            fileData.append('Test', "Test Object values");



            $.ajax({

                url: '/Home/UploadFiles', //URL to upload files 

                type: "POST", //as we will be posting files and other method POST is used

                processData: false, //remember to set processData and ContentType to false, otherwise you may get an error

                contentType: false,      

                data: fileData,

                success: function (result) {

                    alert(result);

                },

                error: function (err) {

                    alert(err.statusText);

                }

            });

         

    });			</code></pre></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">Stafan路易</span>
            <span class="discuss-time">2020.03.09</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以使用JavaScript或jQuery进行异步多个文件上传，而无需使用任何插件即可上传。</font><font style="vertical-align: inherit;">您还可以在进度控件中显示文件上传的实时进度。</font><font style="vertical-align: inherit;">我遇到了2个不错的链接-</font></font></p>

<ol>
<li><a href="http://www.yogihosting.com/multi-file-upload-with-progress-bar-in-asp-net/" rel="nofollow noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有进度条的基于ASP.NET Web窗体的多文件上传功能</font></font></a></li>
<li><a href="http://www.yogihosting.com/jquery-file-upload/" rel="nofollow noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jQuery中基于ASP.NET MVC的多文件上传</font></font></a></li>
</ol>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">服务器端语言是C＃，但是您可以进行一些修改以使其与PHP等其他语言一起使用。</font></font></p>

<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件上传ASP.NET Core MVC：</font></font></strong></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在html中的“查看创建文件”上载控件中：</font></font></p>

<pre class="lang-js prettyprint prettyprinted" style=""><code><span class="pun">&lt;</span><span class="pln">form method</span><span class="pun">=</span><span class="str">"post"</span><span class="pln"> asp</span><span class="pun">-</span><span class="pln">action</span><span class="pun">=</span><span class="str">"Add"</span><span class="pln"> enctype</span><span class="pun">=</span><span class="str">"multipart/form-data"</span><span class="pun">&gt;</span><span class="pln">
    </span><span class="pun">&lt;</span><span class="pln">input type</span><span class="pun">=</span><span class="str">"file"</span><span class="pln"> multiple name</span><span class="pun">=</span><span class="str">"mediaUpload"</span><span class="pln"> </span><span class="pun">/&gt;</span><span class="pln">
    </span><span class="pun">&lt;</span><span class="pln">button type</span><span class="pun">=</span><span class="str">"submit"</span><span class="pun">&gt;</span><span class="typ">Submit</span><span class="pun">&lt;/</span><span class="pln">button</span><span class="pun">&gt;</span><span class="pln">
</span><span class="pun">&lt;/</span><span class="pln">form</span><span class="pun">&gt;</span></code></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">现在在您的控制器中创建操作方法：</font></font></p>

<pre class="lang-js prettyprint prettyprinted" style=""><code><span class="pun">[</span><span class="typ">HttpPost</span><span class="pun">]</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">async</span><span class="pln"> </span><span class="typ">Task</span><span class="pun">&lt;</span><span class="typ">IActionResult</span><span class="pun">&gt;</span><span class="pln"> </span><span class="typ">Add</span><span class="pun">(</span><span class="typ">IFormFile</span><span class="pun">[]</span><span class="pln"> mediaUpload</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="com">//looping through all the files</span><span class="pln">
    foreach </span><span class="pun">(</span><span class="typ">IFormFile</span><span class="pln"> file in mediaUpload</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="com">//saving the files</span><span class="pln">
        string path </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Path</span><span class="pun">.</span><span class="typ">Combine</span><span class="pun">(</span><span class="pln">hostingEnvironment</span><span class="pun">.</span><span class="typ">WebRootPath</span><span class="pun">,</span><span class="pln"> </span><span class="str">"some-folder-path"</span><span class="pun">);</span><span class="pln"> 
        using </span><span class="pun">(</span><span class="kwd">var</span><span class="pln"> stream </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">FileStream</span><span class="pun">(</span><span class="pln">path</span><span class="pun">,</span><span class="pln"> </span><span class="typ">FileMode</span><span class="pun">.</span><span class="typ">Create</span><span class="pun">))</span><span class="pln">
        </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">await</span><span class="pln"> file</span><span class="pun">.</span><span class="typ">CopyToAsync</span><span class="pun">(</span><span class="pln">stream</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span></code></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HostingEnvironment变量的类型为IHostingEnvironment，可以使用依赖项注入将其注入到控制器中，例如：</font></font></p>

<pre class="lang-js prettyprint prettyprinted" style=""><code><span class="kwd">private</span><span class="pln"> </span><span class="typ">IHostingEnvironment</span><span class="pln"> hostingEnvironment</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">public</span><span class="pln"> </span><span class="typ">MediaController</span><span class="pun">(</span><span class="typ">IHostingEnvironment</span><span class="pln"> environment</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    hostingEnvironment </span><span class="pun">=</span><span class="pln"> environment</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">LEYJim</span>
            <span class="discuss-time">2020.03.09</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML5</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">JavaScript</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，上传异步非常容易，我与html一起创建了上传逻辑，由于需要api，因此无法完全正常工作，但是如果您有</font></font><code>/upload</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从网站根目录</font><font style="vertical-align: inherit;">调用的终结点，请演示其工作原理</font><font style="vertical-align: inherit;">，该代码应为您工作：</font></font></p>

<p></p><div class="snippet" data-lang="js" data-hide="false" data-console="true" data-babel="false">
<div class="snippet-code">
<pre class="snippet-code-js lang-js prettyprint prettyprinted" style=""><code><span class="kwd">const</span><span class="pln"> asyncFileUpload </span><span class="pun">=</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  </span><span class="kwd">const</span><span class="pln"> fileInput </span><span class="pun">=</span><span class="pln"> document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"file"</span><span class="pun">);</span><span class="pln">
  </span><span class="kwd">const</span><span class="pln"> file </span><span class="pun">=</span><span class="pln"> fileInput</span><span class="pun">.</span><span class="pln">files</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span><span class="pln">
  </span><span class="kwd">const</span><span class="pln"> uri </span><span class="pun">=</span><span class="pln"> </span><span class="str">"/upload"</span><span class="pun">;</span><span class="pln">
  </span><span class="kwd">const</span><span class="pln"> xhr </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">XMLHttpRequest</span><span class="pun">();</span><span class="pln">
  xhr</span><span class="pun">.</span><span class="pln">upload</span><span class="pun">.</span><span class="pln">onprogress </span><span class="pun">=</span><span class="pln"> e </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">const</span><span class="pln"> percentage </span><span class="pun">=</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">loaded </span><span class="pun">/</span><span class="pln"> e</span><span class="pun">.</span><span class="pln">total</span><span class="pun">;</span><span class="pln">
    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">percentage</span><span class="pun">);</span><span class="pln">
  </span><span class="pun">};</span><span class="pln">
  xhr</span><span class="pun">.</span><span class="pln">onreadystatechange </span><span class="pun">=</span><span class="pln"> e </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">xhr</span><span class="pun">.</span><span class="pln">readyState </span><span class="pun">===</span><span class="pln"> </span><span class="lit">4</span><span class="pln"> </span><span class="pun">&amp;&amp;</span><span class="pln"> xhr</span><span class="pun">.</span><span class="pln">status </span><span class="pun">===</span><span class="pln"> </span><span class="lit">200</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">"file uploaded"</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">};</span><span class="pln">
  xhr</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="str">"POST"</span><span class="pun">,</span><span class="pln"> uri</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">);</span><span class="pln">
  xhr</span><span class="pun">.</span><span class="pln">setRequestHeader</span><span class="pun">(</span><span class="str">"X-FileName"</span><span class="pun">,</span><span class="pln"> file</span><span class="pun">.</span><span class="pln">name</span><span class="pun">);</span><span class="pln">
  xhr</span><span class="pun">.</span><span class="pln">send</span><span class="pun">(</span><span class="pln">file</span><span class="pun">);</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<pre class="snippet-code-html lang-html prettyprint prettyprinted" style=""><code><span class="tag">&lt;form&gt;</span><span class="pln">
  </span><span class="tag">&lt;span&gt;</span><span class="pln">File</span><span class="tag">&lt;/span&gt;</span><span class="pln">
  </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"file"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"file"</span><span class="pln"> </span><span class="atn">name</span><span class="pun">=</span><span class="atv">"file"</span><span class="pln"> </span><span class="atn">size</span><span class="pun">=</span><span class="atv">"10"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
  </span><span class="tag">&lt;input</span><span class="pln"> </span><span class="atn">onclick</span><span class="pun">=</span><span class="atv">"</span><span class="pln">asyncFileUpload</span><span class="pun">()</span><span class="atv">"</span><span class="pln"> </span><span class="atn">id</span><span class="pun">=</span><span class="atv">"upload"</span><span class="pln"> </span><span class="atn">type</span><span class="pun">=</span><span class="atv">"button"</span><span class="pln"> </span><span class="atn">value</span><span class="pun">=</span><span class="atv">"Upload"</span><span class="pln"> </span><span class="tag">/&gt;</span><span class="pln">
</span><span class="tag">&lt;/form&gt;</span></code></pre>
<div class="snippet-result"><div class="snippet-ctas"><button type="button" class="s-btn s-btn__primary"><span class="icon-play-white _hover"></span><span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> 运行代码段</font></font></span></button><input class="copySnippet s-btn s-btn__filled" type="button" value="Copy snippet to answer" style="display: none;"><button type="button" class="s-btn hideResults" style="display: none;">Hide results</button><div class="popout-code"><a class="snippet-expand-link" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">展开摘要</font></font></a></div></div><div class="snippet-result-code" style="display: none;"><iframe name="sif2" sandbox="allow-forms allow-modals allow-scripts" class="snippet-box-edit" frameborder="0"></iframe></div></div></div>
</div>
<p></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还提供有关XMLHttpReques的更多信息：</font></font></p>

<blockquote>
  <p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XMLHttpRequest对象</font></font></strong> </p>
  
  <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有现代浏览器都支持XMLHttpRequest对象。</font><font style="vertical-align: inherit;">XMLHttpRequest对象可用于与后台的Web服务器交换数据。</font><font style="vertical-align: inherit;">这意味着可以更新网页的某些部分，而无需重新加载整个页面。</font></font></p>
</blockquote>

<p><br></p>

<blockquote>
  <p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建一个XMLHttpRequest对象</font></font></strong></p>
  
  <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">所有现代浏览器（Chrome，Firefox，IE7 +，Edge，Safari，Opera）都具有内置的XMLHttpRequest对象。</font></font></p>
  
  <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">创建XMLHttpRequest对象的语法：</font></font></p>
  
  <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">变量=新的XMLHttpRequest（）;</font></font></p>
</blockquote>

<p><br> </p>

<blockquote>
  <p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">跨域访问</font></font></strong></p>
  
  <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">出于安全原因，现代浏览器不允许跨域访问。</font></font></p>
  
  <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这意味着该网页及其尝试加载的XML文件都必须位于同一服务器上。</font></font></p>
  
  <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">W3Schools上的示例位于W3Schools域上的所有打开的XML文件。</font></font></p>
  
  <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果要在自己的一个网页上使用上面的示例，则加载的XML文件必须位于自己的服务器上。</font></font></p>
</blockquote>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">有关更多详细信息，您可以</font></font><a href="https://www.w3schools.com/js/js_ajax_http.asp" rel="nofollow noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此处</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">继续阅读</font><font style="vertical-align: inherit;">...</font></font></p></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">猴子小宇宙</span>
            <span class="discuss-time">2020.03.09</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|使用HTML5的</font></font><a href="https://developer.mozilla.org/en-US/docs/Web/API/FileReader#readAsDataURL%28%29" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">readAsDataURL（）</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或</font></font><a href="http://scotch.io/quick-tips/js/how-to-encode-and-decode-strings-with-base64-in-javascript" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">某些base64编码器</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将文件转换为base64 </font><font style="vertical-align: inherit;">。 
</font></font><a href="http://jsfiddle.net/eliseosoto/JHQnk/" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里摆弄</font></font></a></p>

<pre class="lang-js prettyprint prettyprinted" style=""><code><span class="kwd">var</span><span class="pln"> reader </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">FileReader</span><span class="pun">();</span><span class="pln">

        reader</span><span class="pun">.</span><span class="pln">onload </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">readerEvt</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">var</span><span class="pln"> binaryString </span><span class="pun">=</span><span class="pln"> readerEvt</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">result</span><span class="pun">;</span><span class="pln">
            document</span><span class="pun">.</span><span class="pln">getElementById</span><span class="pun">(</span><span class="str">"base64textarea"</span><span class="pun">).</span><span class="pln">value </span><span class="pun">=</span><span class="pln"> btoa</span><span class="pun">(</span><span class="pln">binaryString</span><span class="pun">);</span><span class="pln">
        </span><span class="pun">};</span><span class="pln">

        reader</span><span class="pun">.</span><span class="pln">readAsBinaryString</span><span class="pun">(</span><span class="pln">file</span><span class="pun">);</span></code></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">然后检索：</font></font></p>

<pre class="lang-js prettyprint prettyprinted" style=""><code><span class="pln">window</span><span class="pun">.</span><span class="pln">open</span><span class="pun">(</span><span class="str">"data:application/octet-stream;base64,"</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> base64</span><span class="pun">);</span></code></pre></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">神奇Jim</span>
            <span class="discuss-time">2020.03.09</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您可以</font></font><a href="http://whats-online.info/science-and-tutorials/30/select-preview-rename-and-upload-image-using-jquery-Ajax/" rel="noreferrer" data-bitapp="processed"><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在此处</font></font></strong></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">看到带有有效演示的解决方案</font><font style="vertical-align: inherit;">，可以预览表单文件并将其提交到服务器。</font><font style="vertical-align: inherit;">对于您的情况，您需要使用</font></font><a href="http://en.wikipedia.org/wiki/Ajax_%28programming%29" rel="noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ajax</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">来方便将文件上传到服务器：</font></font></p>

<pre class="lang-js prettyprint prettyprinted" style=""><code><span class="pun">&lt;</span><span class="kwd">from</span><span class="pln"> action</span><span class="pun">=</span><span class="str">""</span><span class="pln"> id</span><span class="pun">=</span><span class="str">"formContent"</span><span class="pln"> method</span><span class="pun">=</span><span class="str">"post"</span><span class="pln"> enctype</span><span class="pun">=</span><span class="str">"multipart/form-data"</span><span class="pun">&gt;</span><span class="pln">
    </span><span class="pun">&lt;</span><span class="pln">span</span><span class="pun">&gt;</span><span class="typ">File</span><span class="pun">&lt;/</span><span class="pln">span</span><span class="pun">&gt;</span><span class="pln">
    </span><span class="pun">&lt;</span><span class="pln">input type</span><span class="pun">=</span><span class="str">"file"</span><span class="pln"> id</span><span class="pun">=</span><span class="str">"file"</span><span class="pln"> name</span><span class="pun">=</span><span class="str">"file"</span><span class="pln"> size</span><span class="pun">=</span><span class="str">"10"</span><span class="pun">/&gt;</span><span class="pln">
    </span><span class="pun">&lt;</span><span class="pln">input id</span><span class="pun">=</span><span class="str">"uploadbutton"</span><span class="pln"> type</span><span class="pun">=</span><span class="str">"button"</span><span class="pln"> value</span><span class="pun">=</span><span class="str">"Upload"</span><span class="pun">/&gt;</span><span class="pln">
</span><span class="pun">&lt;/</span><span class="pln">form</span><span class="pun">&gt;</span></code></pre>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">提交的数据是一个formdata。</font><font style="vertical-align: inherit;">在您的jQuery上，使用表单提交功能而不是单击按钮来提交表单文件，如下所示。</font></font></p>

<pre class="lang-js prettyprint prettyprinted" style=""><code><span class="pln">$</span><span class="pun">(</span><span class="pln">document</span><span class="pun">).</span><span class="pln">ready</span><span class="pun">(</span><span class="kwd">function</span><span class="pln"> </span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
   $</span><span class="pun">(</span><span class="str">"#formContent"</span><span class="pun">).</span><span class="pln">submit</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">(</span><span class="pln">e</span><span class="pun">){</span><span class="pln">

     e</span><span class="pun">.</span><span class="pln">preventDefault</span><span class="pun">();</span><span class="pln">
     </span><span class="kwd">var</span><span class="pln"> formdata </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">FormData</span><span class="pun">(</span><span class="kwd">this</span><span class="pun">);</span><span class="pln">

 $</span><span class="pun">.</span><span class="pln">ajax</span><span class="pun">({</span><span class="pln">
     url</span><span class="pun">:</span><span class="pln"> </span><span class="str">"ajax_upload_image.php"</span><span class="pun">,</span><span class="pln">
     type</span><span class="pun">:</span><span class="pln"> </span><span class="str">"POST"</span><span class="pun">,</span><span class="pln">
     data</span><span class="pun">:</span><span class="pln"> formdata</span><span class="pun">,</span><span class="pln">
     mimeTypes</span><span class="pun">:</span><span class="str">"multipart/form-data"</span><span class="pun">,</span><span class="pln">
     contentType</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln">
     cache</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln">
     processData</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln">
     success</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(){</span><span class="pln">

     alert</span><span class="pun">(</span><span class="str">"successfully submitted"</span><span class="pun">);</span><span class="pln">

     </span><span class="pun">});</span><span class="pln">
   </span><span class="pun">});</span><span class="pln">
</span><span class="pun">});</span></code></pre>

<p><a href="http://whats-online.info/science-and-tutorials/30/select-preview-rename-and-upload-image-using-jquery-Ajax/" rel="noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">查看更多细节</font></font></a></p></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">猿小宇宙小哥</span>
            <span class="discuss-time">2020.03.09</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我发现的解决方案是将</font></font><code>&lt;form&gt;</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目标</font><font style="vertical-align: inherit;">设为</font><font style="vertical-align: inherit;">隐藏的iFrame。</font><font style="vertical-align: inherit;">然后，iFrame可以运行JS以向用户显示其已完成（页面加载时）。</font></font></p></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">A小卤蛋Pro</span>
            <span class="discuss-time">2020.03.09</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">注意：此答案已过时，现在可以使用XHR上传文件。</font></font></p>

<hr>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您不能使用</font></font><a href="http://en.wikipedia.org/wiki/XMLHttpRequest" rel="noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">XMLHttpRequest</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">（Ajax）</font><font style="vertical-align: inherit;">上传文件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">您可以使用iframe或Flash模拟效果。</font><font style="vertical-align: inherit;">出色的</font></font><a href="http://malsup.com/jquery/form/" rel="noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">jQuery表单插件</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，可通过iframe发布文件以获得效果。</font></font></p></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">飞云小胖</span>
            <span class="discuss-time">2020.03.09</span>
          </div>
          <div class="discuss-comment"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2019更新：它</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">仍然</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">取决于</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">您的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人口统计使用</font><font style="vertical-align: inherit;">的浏览器</font><font style="vertical-align: inherit;">。</font></font></h2>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用“新” HTML5 </font></font><code>file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">API </font><font style="vertical-align: inherit;">需了解的重要一点</font><font style="vertical-align: inherit;">是，</font></font><a href="http://caniuse.com/fileapi" rel="nofollow noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">直到IE 10才支持</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您瞄准的特定市场对较旧版本的Windows具有高于平均水平的倾向，则您可能无权使用它。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">截至2017年，大约5％的浏览器是IE 6、7、8或9之一。如果您进入一家大公司（例如，这是B2B工具，或者您要提供培训的内容），那么这个数字可能会飙升。</font><font style="vertical-align: inherit;">2016年，我与一家使用IE8的公司进行了交易，这些公司的机器中有60％以上使用IE8。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">截至本次编辑截止到2019年，距我最初的回答已经过去11年了。</font><font style="vertical-align: inherit;">IE9及更低版本在</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">全球范围内均</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在1％左右，但仍存在使用率更高的集群。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最重要的外卖从这个-whatever的特征-是</font></font><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">检查什么的浏览器</font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">的</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">用户使用</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">如果您不这样做，您将学到一个快速而痛苦的课程，以了解为什么“为我工作”在交付给客户的产品中不够好。</font></font><a href="https://caniuse.com/" rel="nofollow noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">caniuse</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">是一个有用的工具，但请注意他们从哪里获得人口统计信息。</font><font style="vertical-align: inherit;">它们可能与您的不一致。</font><font style="vertical-align: inherit;">这从未比企业环境真实。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我在2008年的回答如下。</font></font></p>

<hr>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">但是，存在可行的非JS文件上传方法。</font><font style="vertical-align: inherit;">您可以在页面上创建一个iframe（使用CSS隐藏该iframe），然后将表单定位为发布到该iframe。</font><font style="vertical-align: inherit;">主页不需要移动。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这是一个“真实”的帖子，因此并不完全是交互式的。</font><font style="vertical-align: inherit;">如果您需要状态，则需要服务器端进行处理。</font><font style="vertical-align: inherit;">具体取决于您的服务器。</font></font><a href="http://en.wikipedia.org/wiki/ASP.NET" rel="nofollow noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ASP.NET</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">具有更好的机制。</font><font style="vertical-align: inherit;">PHP Plain失败了，但是您可以使用</font></font><a href="http://en.wikipedia.org/wiki/Perl" rel="nofollow noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Perl</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或Apache修改来解决它。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果需要多个文件上传，则最好一次执行一个文件（以克服最大文件上传限制）。</font><font style="vertical-align: inherit;">将第一个表单发布到iframe中，使用上述方法监视进度，完成后，将第二个表单发布到iframe中，依此类推。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">或使用Java / Flash解决方案。</font><font style="vertical-align: inherit;">他们可以更灵活地处理自己的帖子...</font></font></p></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">Gil伽罗小宇宙</span>
            <span class="discuss-time">2020.03.09</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我建议</font><font style="vertical-align: inherit;">为此</font><font style="vertical-align: inherit;">使用</font></font><a href="http://fineuploader.com/demos.html" rel="noreferrer" data-bitapp="processed"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fine Uploader</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">插件。</font><font style="vertical-align: inherit;">您的</font></font><code>JavaScript</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">代码为：</font></font></p>

<pre class="lang-js prettyprint prettyprinted" style=""><code><span class="pln">$</span><span class="pun">(</span><span class="pln">document</span><span class="pun">).</span><span class="pln">ready</span><span class="pun">(</span><span class="kwd">function</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
  $</span><span class="pun">(</span><span class="str">"#uploadbutton"</span><span class="pun">).</span><span class="pln">jsupload</span><span class="pun">({</span><span class="pln">
    action</span><span class="pun">:</span><span class="pln"> </span><span class="str">"addFile.do"</span><span class="pun">,</span><span class="pln">
    onComplete</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">response</span><span class="pun">){</span><span class="pln">
      alert</span><span class="pun">(</span><span class="pln"> </span><span class="str">"server response: "</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> response</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
  </span><span class="pun">});</span><span class="pln">
</span><span class="pun">});</span></code></pre></div>
        </div></div>
    </div>
    {% endraw %}
  </div>
<div>
