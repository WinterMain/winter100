---
layout: question
title:  git存储库中是否应包含“ node_modules”文件夹
date:   2020-03-24T07:14:33.000Z
description: 我想知道在检查代码时是否应该在回购中跟踪node_modules或进行npm安装？...
img: 
author: 猪猪Green
category: question
answer: 7
tags: git Node.js
topic: Node.js
---
<div class="article-root">
  <div class="article">
    {% include articleTitle.html info=page %}
    {% raw %}
    <div class="article-content"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我想知道在检查代码时是否应该在回购中跟踪node_modules或进行npm安装？</font></font></p></div>
    {% endraw %}
  </div>
  <p class="winter_mark">第3426篇《git存储库中是否应包含“ node_modules”文件夹》来自Winter(https://github.com/aiyld/aiyld.github.io)的站点</p>
  <div class="discuss-wrapper">
    {% include discussTitle.html info=page %}
    {% raw %}
    <div class="discuss-list">
    <div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">null</span>
            <span class="discuss-time">2020.03.24</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">如果package.json中提到依赖项，则不需要签入node_modules。</font><font style="vertical-align: inherit;">任何其他程序员都可以通过执行npm install来简单地获取它，并且npm足够聪明，可以在项目的工作目录中创建node_modules。</font></font></p></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">番长猴子</span>
            <span class="discuss-time">2020.03.24</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我想提供一个中间的选择。</font></font></p>

<ol>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不要添加</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">到git中。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用</font></font><code>package-lock.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">文件确定依赖项版本。</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在CI或发布过程中，发布版本时，请复制node_modules文件夹并进行备份（例如，在云存储中）。</font></font></li>
</ol>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在极少数情况下，您无法访问NPM（或您使用的其他注册表）或NPM中的特定程序包，则可以拥有node_modules的副本，并且可以继续工作直到恢复访问权限。</font></font></p></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">樱小胖Mandy</span>
            <span class="discuss-time">2020.03.24</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">还有一两件事要考虑：在检查</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">就更难/不可能使用之间的区别</font></font><code>dependencies</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">和</font></font><code>devDependencies</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不过，另一方面，可以说，将通过测试的代码完全相同的生产放到生产中是令人放心的-因此包括</font></font><code>devDependencies</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">达蒙</span>
            <span class="discuss-time">2020.03.24</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我知道这个话题很老。</font><font style="vertical-align: inherit;">但是由于npm生态系统的情况发生变化，我缺少对此处提供的论点的一些更新。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我总是建议不要将node_modules置于版本控制之下。</font><font style="vertical-align: inherit;">到目前为止，从接受的答案中列出的这样做的几乎所有好处都已经过时了。</font></font></p>

<ol>
<li><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">无法轻易从npm注册表中撤消已发布的软件包。</font><font style="vertical-align: inherit;">因此，您不必担心项目以前依赖的松散的依赖关系。</font></font></p></li>
<li><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">将package-json.lock文件放入VCS可以帮助频繁更新依赖关系，尽管依赖于相同的package.json文件，但可能导致不同的设置。</font></font></p></li>
</ol>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，在拥有离线构建工具的情况下，将node_modules放入VCS可能被认为是唯一剩下的合格用例。</font><font style="vertical-align: inherit;">但是，node_modules通常会快速增长。</font><font style="vertical-align: inherit;">任何更新都会更改很多文件。</font><font style="vertical-align: inherit;">这以不同的方式影响存储库。</font><font style="vertical-align: inherit;">如果您真的考虑了长期影响，那么这也可能是一个障碍。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">像svn这样的集中式VCS要求通过网络传输已提交和已签出的文件，这在签出或更新node_modules文件夹时会非常缓慢。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">当涉及到git时，大量的其他文件将立即污染存储库。</font><font style="vertical-align: inherit;">请记住，git不会跟踪任何文件版本之间的差异，而是会在单个字符更改后立即存储文件任一版本的副本。</font><font style="vertical-align: inherit;">对任何依赖项的每次更新都会导致另一个较大的变更集。</font><font style="vertical-align: inherit;">由于这会影响备份和远程同步，因此您的git存储库将迅速变得庞大。</font><font style="vertical-align: inherit;">如果您决定稍后从git存储库中删除node_modules，则由于历史原因，它仍然是其中的一部分。</font><font style="vertical-align: inherit;">如果您已将git存储库分发到某个远程服务器（例如用于备份），则清理它是您将要执行的又一个痛苦且容易出错的任务。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因此，如果您关心高效的流程并希望将事情保持在“较小”的水平，我宁愿使用单独的工件存储库，例如Nexos存储库（或者只是一些带有ZIP存档的HTTP服务器），以提供一些以前提取的依赖项供下载。</font></font></p></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">Stafan</span>
            <span class="discuss-time">2020.03.24</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">模块详细信息存储在中</font></font><code>packages.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，这就足够了。</font><font style="vertical-align: inherit;">无需办理登机手续</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">人们过去通常存储</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在版本控制中来锁定模块的依赖关系，但是有了</font></font><a href="https://docs.npmjs.com/cli/shrinkwrap" rel="noreferrer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">npmrinkwraprap</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">，就不再需要了。</font></font></p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这一点的另一种理由，如@ChrisCM在评论中写道：</font></font></p>

<blockquote>
  <p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">同样值得注意的是，任何涉及本机扩展的模块将无法在不同架构之间工作，需要重新构建。</font><font style="vertical-align: inherit;">提供具体理由说明不将其包括在存储库中。</font></font></p>
</blockquote></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">小胖Gil</span>
            <span class="discuss-time">2020.03.24</span>
          </div>
          <div class="discuss-comment"><p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我建议不要检入node_modules，</font></font></strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">因为例如PhantomJS和node-sass之类的软件包会为当前系统安装适当的二进制文件。</font></font></p>

<p><strong><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这意味着，如果一个开发人员</font></font><code>npm install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在Linux上运行并检入node_modules –它对于在Windows上克隆该存储库的另一个开发人员将无效。</font></font></strong> </p>

<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最好检查一下哪个npm安装下载的压缩文件并指向</font></font><code>npm-shrinkwrap.json</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">它们。</font><font style="vertical-align: inherit;">您可以使用</font></font><a href="https://github.com/JamieMason/shrinkpack" rel="noreferrer"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">rinkepack</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">自动执行此过程</font><font style="vertical-align: inherit;">。</font></font></p></div>
        </div></div><div class="discuss-item">
        <div class="discuss-parent">
          <div class="discuss-meta">
            <span class="discuss-user">卡卡西Near</span>
            <span class="discuss-time">2020.03.24</span>
          </div>
          <div class="discuss-comment"><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">使用源代码控制进行</font><font style="vertical-align: inherit;">跟踪</font><font style="vertical-align: inherit;">是正确的选择，因为某些NodeJS模块（例如MongoDB NodeJS驱动程序）使用NodeJS C ++加载项。</font><font style="vertical-align: inherit;">运行</font></font><code>npm install</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">命令</font><font style="vertical-align: inherit;">时会编译这些附加组件</font><font style="vertical-align: inherit;">。</font><font style="vertical-align: inherit;">因此，当您跟踪</font></font><code>node_modules</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目录时，可能会意外提交操作系统特定的二进制文件。</font></font></p></div>
        </div></div>
    </div>
    {% endraw %}
  </div>
<div>
